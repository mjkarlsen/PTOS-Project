---
title: "MSDS Capstone Project"
author: "Matt Carlson"
date: "4/11/2020"
---

```{r, setup}

# devtools::install_github("markfairbanks/tidytable")
# devtools::install_github("ultramattyice/traumaR")

pacman::p_load( traumaR
                # tidytable, 
                # data.table, 
                janitor, 
                broom, 
                tidyverse, 
                fpp3, 
                lubridate, 
                DataExplorer, 
                gt, 
                ggthemes,
                tictoc 
                 
                # tidystringdist, 
)

options(scipen=999)  #remove scientific notation
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.width = 12)
knitr::opts_chunk$set(fig.height = 10)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(paged.print=FALSE)

```

# Data Preparation with traumaR
* Created a R Library called [traumaR](https://github.com/ultramattyice/traumaR) to consolidate all of the data manipulation 


## Drop Columns
Decided to remove any columns that only contain NA or NULL values to assist reducing the size of data. 

## Diagnosis Results
### Only pull results from Forearm Fractures


## Complications Results
### Only pull results from Forearm Fractures


```{r message=TRUE}

raw_data <- fread("E:/Northwestern/12 - Capstone/PTOS_Data_toy.csv", na.strings = c("<unk>", "", "<n/a>")) %>%  
  as.data.table() 

#example data for traumaR package
#data.table::fwrite(raw_data %>% head(30000), file = "E:/Northwestern/12 - Capstone/PTOS_Toy.csv")

traumaR::run_full_show(raw_data)

```

# Let's clean up the transactional data

```{r data_for_analysis}

trans_full_df %>% 
  filter.(id == '0101188020001731')

patient_df %>% 
  filter.(id == '0101188020001731')



create_injury_df <- function(.data){

  .data %>%
    select.(id, inj_date_a, inj_time_a, e849_x, e_code) %>% 
    mutate.(date = ifelse(!is.na(inj_date_a), as.character(inj_date_a), NULL),
            time =  ifelse(!is.na(inj_time_a), as.character(inj_time_a), NULL),
            loc_desc = injury_loc(e849_x),
            code_cd = e_code,
            code_desc = e_code(e_code),
            data_source = "injury") %>% 
    select.(id, date, time, loc_desc, code_cd, code_desc, data_source) %>% 
    slice.(1, by = id)


}


create_injury_df(ptos_df)


ptos_df %>% 
  select.(id, inj_date_a, inj_time_a, e849_x, e_code) %>% 
   mutate.(date = ifelse(!is.na(inj_date_a), as.character(inj_date_a), NULL),
            time =  ifelse(!is.na(inj_time_a), as.character(inj_time_a), NULL),
            loc_desc = injury_loc(e849_x),
            code_cd = e_code,
            code_desc = e_code(e_code),
            data_source = "injury") %>% 
  select.(id, date, time, loc_desc, code_cd, code_desc, data_source) %>% 
  slice.(1, by = id)

  


```








